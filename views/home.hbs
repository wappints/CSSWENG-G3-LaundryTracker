<!DOCTYPE html>
<html>
   <head>
      <meta charset = "UTF-8">
      <title>Home</title>
  
    <script type="text/javascript" src="./node_modules/jquery/dist/jquery.min.js" ></script>
             <link rel="stylesheet" href="public/css/nav.css">
              <link rel="stylesheet" href="public/css/styles.css">
                      <link rel="stylesheet" href="public/css/home.css">
        <link rel ="stylesheet"  href="./bower_components/bootstrap/dist/css/bootstrap.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">

   
     
   <body>      
     {{> header}}


      </div>
   </div>
   </nav>
         
         <!-- Cart -->
      <div class="container-fluid">
      <div class="row">
        <!-- Page Header -->

        <div class="col-md-1 mt-3">
          <button class="btn btn-primary" data-toggle="modal" data-target="#salesBtn">Add Sales</button>
        </div>

        <div class='col-md-1 mt-3'>
          <button class='btn btn-primary' data-toggle="modal" data-target="#editPrice">Edit Price</button>
        </div>

        <div class="col-md-9">
          <div id ="hiddenDate" hidden>{{DDate}}</div>
          <div id ="hiddenAcc" hidden>{{ACCType}}</div>
          <div id ="indexing" hidden>0</div>
          <h3 class="text-center mt-3 mb-3 col-10">
            <form id = "THEDATEFORM" method="post" action="">
          <button id="prevDatebtn" form="THEDATEFORM" class="btn btn-outline-primary">
            <i class="bi bi-caret-left-fill"></i></button></i> <div id="THEDATE">{{DDate}} </div>
          <button id="nextDatebtn" form="THEDATEFORM" class="btn btn-outline-primary">
            <i class="bi bi-caret-right-fill"></i></button> </h3>
            </form>
        </div>

        <script>
            // $("#prevDatebtn")
            $("#nextDatebtn").click((event) => {
              var DDate = $('#hiddenDate').text()
               var ACCType = $('#hiddenAcc').text()
               var indexing = parseInt($('#indexing').text())
               var purpose = "next"
               console.log(DDate)
               console.log(ACCType)

              var newDate = new Date(DDate)
               newDate.setDate(newDate.getDate() + 1) 
               DDate = newDate.toISOString().split('T')[0];
               console.log(DDate)
                 document.getElementById("THEDATEFORM").setAttribute("action", "/home/" + ACCType + "/" LastDate)
                document.getElementById("THEDATEFORM").submit()
          });
                $("#prevDatebtn").click((event) => {
              var DDate = $('#hiddenDate').text()
               var ACCType = $('#hiddenAcc').text()
               var indexing = parseInt($('#indexing').text())
               var purpose = "previous"
               //var stringPost =  "/next" + "/" + ACCType
               console.log(ACCType)
              var newDate = new Date(DDate)
               newDate.setDate(newDate.getDate() - 1) 
               var LastDate = newDate.toISOString().split('T')[0];
                console.log(LastDate)      
                document.getElementById("THEDATEFORM").setAttribute("action", "/home/" + ACCType + "/" LastDate)
                document.getElementById("THEDATEFORM").submit()
          });
          //})
        </script>

        <div class="col-md-1 mt-3 editsales">
          Edit Sales:
          <label class="switch">
            <input type="checkbox">
            <span class="slider round"></span>
          </label>
        </div>

        <!--model for editPrice-->

        <div class="modal fade" id="editPrice" tabindex="-1" role="dialog" aria-labelledby="salesModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Price</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <form method="post" action="/edit" id="editSaleForm" >
              <div class="modal-body">
                <div class="container-fluid">
                    <div hidden> {{ACCType}} </div>
                  


                  <div class="row">
                    <div class="col-md-4 ml-auto" >Thin Wash</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="ETNWPrice" id="ETNWPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.TNWPrice}}">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Thin Dry</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="ETNDPrice" id="ETNDPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.TNDPrice}}">
                    </div>
                  </div>

                  <div class="row  mt-2">
                    <div class="col-md-4 ml-auto" >Thick Wash</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="ETKWPrice" id="ETKWPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.TKWPrice}}">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Thick Dry</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="ETKDPrice" id="ETKDPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.TKDPrice}}">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Fold</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="EFOLDPrice" id="EFOLDPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.FOLDPrice}}">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Soap</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="ESOAPPrice" id="ESOAPPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.SOAPPrice}}">
                    </div>
                  </div>
                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Downy</div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" class="EDITSALES_INPUTidentifier" name="EDOWNPrice" id="EDOWNPrice" onkeypress="return /[0-9]/i.test(event.key)" value="{{object.DOWNPrice}}">
                    </div>
                  </div>

                  <div class="row mt-2">
                   
                      <script>
                      $(".EDITSALES_INPUTidentifier").on("change paste keyup cut select", function()
                      {
                        console.log("JABOL")
                        console.log($("#EDOWNPrice").val())
                      })
                      
                        </script>
                    <button class="col-3 text-right btn btn-danger ml-4" data-dismiss="modal">Cancel</button>
                    <div class="col-1"></div>
                    <button class="col-3 text-right btn btn-success" form="editSaleForm" target="_self">Confirm</button>
                    </form>
                  </div>
                  </div>
                </div>          
              </div>
            </div>
          </div>
        </div>

        <!--modal for Add Sales-->
        <div hidden> 
        <div  id="TNWPrice"  name ="TNWPrice"> {{object.TNWPrice}}</div>
        <div  id="TNDPrice"  name="TNDPrice" >{{object.TNDPrice}}</div>
        <div  id="TKWPrice"  name="TKWPrice" >{{object.TKWPrice}}</div>
        <div  id="TKDPrice"  name="TKDPrice" >{{object.TKDPrice}}</div>
        <div  id="FOLDPrice" name="FOLDPrice" >{{object.FOLDPrice}}</div>
        <div  id="SOAPPrice" name="SOAPPrice">{{object.SOAPPrice}}</div>
        <div  id="DOWNPrice" name="DOWNPrice">{{object.DOWNPrice}}</div>
          
        </div>

        <div class="modal fade" id="salesBtn" tabindex="-1" role="dialog" aria-labelledby="salesModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Sales</h5>
                <button type="button" onclick="xAddSale()" class="close" id="xAddSalebtn" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              
              <div class="modal-body">
                <div class="container-fluid" id="ADDSalesID">
                  <form method="post" action="/home/{{ACCType}}/{{DDate}}" id="addSaleForm">
                  <div class="row">
                    <div class="col-md-4">

                      <p>Name</p>

                    </div>

                    <div class="col-md-8 ml-auto">
                      <input type="text" onkeypress="return /[a-z]/i.test(event.key)" id="ADDName" name="ADDName">

                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md-4 ml-auto" >Phone</div>
                    <div class="col-md-8 ml-auto">
                      <input onkeypress="return /[0-9]/i.test(event.key)" type="text" id="ADDPhone" name="ADDPhone">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto" >Thin Wash</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)" type="tel" size="4" id="ADDThinW" name="ADDThinW" value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Thin Dry</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)" type="tel" size="4" id="ADDThinD" name="ADDThinD"  value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Thick Wash</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)" type="tel" size="4" id="ADDThickW"  name="ADDThickW" value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Thin Dry</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)"  type="tel" size="4" id="ADDThickD" name="ADDThickD" value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto"  >Fold</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)" type="tel" size="4" id="ADDFold" name="ADDFold" value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto" >Soap</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)"  type="tel" size="4" id="ADDSoap" name="ADDSoap" value="0">
                    </div>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Downy</div>
                    <div class="col-md-8 ml-auto">
                      <input class="ADDSALES_INPUTidentifier" onkeypress="return /[0-9]/i.test(event.key)" type="tel" size="4" id="ADDDowny" name="ADDDowny" value="0">
                    </div>
                  </div>

                  

                  <div class="row mt-3">
                    <div class="col-md ml-auto" text="text-left" id="ADDTotalPrice" name="ADDTotalPrice">Total Price: </div>
                    <input  type="number" size="4" id="ADDTotalPriceR" name="ADDTotalPriceR" value="0" readonly>
                  </div>

                  <div class="row mt-2">
                    <div class="col-md-4 ml-auto">Amount Paid: </div>
                    <div class="col-md-8 ml-auto">
                      <input type="tel" size="4" onkeypress="return /[0-9]/i.test(event.key)" id="ADDAmountPaid" name="ADDAmountPaid">
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-md ml-auto" id="ADDBalance">Balance: </div>
                    <input  type="number" size="4" id="ADDBalanceR" name="ADDBalanceR" value="0" readonly>
                  </div>
                  <script>
                    /*window.onload() = function(){
                      var jaba = parseInt($("#TNWPrice").text())
                      console.log(jaba)
                    }*/
                    function xAddSale()
                    {
                      console.log("X BUTTON")
                      $(".ADDSALES_INPUTidentifier").each(function(index, element)
                      {
                          $("#ADDName").val("") 
                          $("#ADDPhone").val("") 
                          $(this).val(0)  
                          $("#ADDTotalPriceR").val(0) 
                          $("#ADDBalanceR").val(0) 
                      })
                      
                    }
                    $(".ADDSALES_INPUTidentifier").on("change paste keyup cut select", function() {
                      console.log("OUCH")
                      //$(".ADDSALES_INPUTidentifier").val().replace(/^[0]+/g,0)
                      var TNWPrice = parseInt($("#TNWPrice").text())
                      var TNDPrice =parseInt($("#TNDPrice").text())
                      var TKWPrice =parseInt($("#TKWPrice").text())
                      var TKDPrice =parseInt($("#TKDPrice").text())
                      var FOLDPrice =parseInt($("#FOLDPrice").text())
                      var SOAPPrice =parseInt($("#SOAPPrice").text())
                      var DOWNPrice =parseInt($("#DOWNPrice").text())
                      var TNWQty = parseInt($("#ADDThinW").val())
                      var TNDQty = parseInt($("#ADDThinD").val())
                      var TKWQty = parseInt($("#ADDThickW").val())
                      var TKDQty = parseInt($("#ADDThickD").val())
                      var FOLDQty = parseInt($("#ADDFold").val())
                      var SOAPQty = parseInt($("#ADDSoap").val())
                      var DOWNQty = parseInt($("#ADDDowny").val())
                      /*
                     console.log(TNWPrice)
                     console.log(TNDPrice)
                     console.log(TKWPrice)
                     console.log(TKDPrice)
                     console.log(FOLDPrice)
                     console.log(SOAPPrice)
                     console.log(DOWNPrice)
                     console.log(TNWQty)
                     console.log(TNDQty )
                     console.log(TKDQty)
                     console.log(TKWQty)
                     console.log(FOLDQty)
                     console.log(DOWNQty)
                      console.log(SOAPQty)
                      */
                      var computation = TNWPrice * TNWQty + TNDPrice * TNDQty +  TKWPrice * TKWQty +  TKDPrice * TKDQty +  FOLDPrice * FOLDQty + SOAPPrice * SOAPQty + DOWNPrice * DOWNQty
                      
                      $("#ADDTotalPriceR").val(computation);
                    });

                    $("#ADDAmountPaid").on("change paste keyup cut select", function() {
                      $("#ADDBalanceR").val( $("#ADDTotalPriceR").val() - $("#ADDAmountPaid").val()) 
                    });

                    </script>

                  <div class="row mt-2">
                    

                    <button class="col-3 text-right btn btn-danger" onclick="xAddSale()" data-dismiss="modal" id="cancelAddSalebtn">Cancel</button>
                    <div class="col-1"></div>
                    <button class="col-3 text-right btn btn-success ml-2" form="addSaleForm" target="_self">Confirm</button>
                  </div>
                  </form>

                  </div>
                </div>
              </div>


              


            </div>
          </div>
        </div>

        <!-- Table Cart -->
        <!-- Header -->
        <div class="col-md-12">
          <table class="table text-center table-striped">
            <thead class="thead-dark">
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Thin Wash</th>
                <th scope="col">Thin Dry</th>
                <th scope="col">Thick Wash</th>
                <th scope="col">Thick Dry</th>
                <th scope="col">Fold</th>
                <th scope="col">Soap</th>
                <th scope="col">Downy</th>
                <th scope="col">Total Price</th>
                <th scope="col">Amount Paid</th>
                <th scope="col">Balance</th>
                <th scope="col">Token Error</th>
                <th scope="col">Phone Number</th>
              </tr>
            </thead>

            <!-- Table Body -->
            <tbody>
                                             {{#each this.entry}}
               <tr id="FinancialEntry" name="FinancialEntry">
                <td hidden><div id="Entry_id" name="Entry_id" >{{this.SalesID}}</div>  </td>      
                <td ><input  id ="NAMEField" class="text-center" size="20" value="{{this.Name}}"readonly>  </td>
                <td ><input  id ="TNWField"class="text-center" size="1" value="{{this.ThinWash}}" readonly>  </td>
                <td ><input  id ="TNDField"class="text-center" size="1" value="{{this.ThinDry}}" readonly>  </td>
                <td ><input  id ="TKWField"class="text-center" size="1" value="{{this.ThickWash}}" readonly>  </td>
                <td ><input  id ="TKDField" class="text-center" size="1" value="{{this.ThickDry}}" readonly>  </td>
                <td ><input  id ="FOLDField" class="text-center" size="1" value="{{this.Fold}}" readonly>  </td>
                <td ><input  id ="SOAPField" class="text-center" size="1" value="{{this.Soap}}" readonly>  </td>
                <td ><input  id ="DOWNField" class="text-center" size="1" value="{{this.Downy}}" readonly> </td>
                <td  width="100"> <input  id ="TTLField" class="text-center" size="5" value="{{this.totalPrice}}" readonly> </td>
                <td  width="100"> <input  id ="AMTField" class="text-center" size="5" value="{{this.AmountPaid}}" readonly> </td>
                <td  width="100"> <input  id ="BALField" class="text-center" size="5" value="{{this.Balance}}" readonly> </td>
                <td>
                  <input id ="TOKENField" class="text-center" size="1" value ="{{this.Token}}" readonly> 
                </td>
                <td ><input id ="PHONEField" class="text-center" size="11" value="{{this.PhoneNumber}}" readonly></td>

                <td><a class="btn btn-outline-danger "><i class="bi bi-trash" href="/delete" data-toggle="modal" data-target="#DeleteAccountModal"></i></a></td>
              </tr>

              {{/each}}
            </tbody>
            <script >     $('.btn.btn-outline-danger').click((event) => { 
              entry = event.currentTarget.parentElement.parentElement.innerHTML
              //console.log(entry)
              var card = event.currentTarget.parentElement.parentElement.querySelector("#Entry_id").innerHTML
              //console.log(card)
              //console.log("ID gotten is " + card);

            $.get('/delete', {_id : card}, function (result) {
            
            });
            $(event.currentTarget.parentElement.parentElement).remove();
    });
    </script>
            <tr>
              <td>Total: </td>
              <td> <input  id ="TNWSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TNDSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TKWSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TKDSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="FOLDSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="SOAPSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="DOWNSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TTLSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="AMTSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TNWSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
              <td> <input  id ="TNWSum" class="text-center ADDSALES_EDITidentifier" size="5" value="0" readonly></td>
            </tr>
            <!-- End of Table Body -->

          </table>
          <script>
            window.onload = function()
            {
              
              var numRows = document.getElementsByName("FinancialEntry").length 
              console.log(numRows)
              //$("#TNWSum").val() 
            }
            //$(".ADDSALES_EDITidentifier ").on("change paste keyup cut select", function() {}
          </script>
          
          <!-- End of Table -->
        </div>

        </div>



         <!-- JQuery -->
 <!-- <script
 src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
 integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
 crossorigin="anonymous"
></script> -->

<!-- Popper -->
<script
 src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
 integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
 crossorigin="anonymous"
></script>
<!-- Bootstrap -->
<script
 src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
 integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
 crossorigin="anonymous"
></script>
   </body>
</html>